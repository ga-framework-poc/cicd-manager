name: build-component
on:
  push:
    branch: development
  workflow_dispatch:
jobs:
  setup-environment:
    runs-on: build.mdw.nicks.world
    steps:
    - id: setup-environment
      name: setup-environment
      run: |
        echo ::set-output name=CICD_TOKEN::$(cat /var/secrets/PAT_TOKEN)
    outputs:
      matrix: ${{ steps.setup-environment.outputs.CICD_TOKEN }}
  build-and-deploy:
    needs: setup-environment
    uses: nicks-world/cicd-manager.github/workflows/build-and-deploy.yml@master
    with:
      system-name: %SYSTEM_NAME%
    secrets:
      CICD_TOKEN: ${{ needs.setup-environment.outputs.CICD_TOKEN }}